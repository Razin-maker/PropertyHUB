<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properties - PropertyHub</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header>
        <div class="logo-container">
            <h1>PropertyHub</h1>
            <p>Premium Business Real Estate</p>
        </div>
        <nav>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="properties.html" class="active">Properties</a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="register.html">Register</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero" style="padding: 60px 20px;">
        <div class="hero-content">
            <h2>Explore Business Properties</h2>
            <p>Find the perfect commercial property for your business in Bangladesh</p>
        </div>
    </section>

    <div class="properties-container" style="padding: 50px; max-width: 1200px; margin: 0 auto;">
        <div class="properties-filters" style="display: flex; justify-content: space-between; margin-bottom: 30px;">
            <div class="filter-group" style="display: flex; gap: 15px;">
                <select class="form-control" name="property-type">
                    <option value="">All Property Types</option>
                    <option value="office">Office Space</option>
                    <option value="retail">Retail Space</option>
                    <option value="warehouse">Warehouse</option>
                    <option value="industrial">Industrial Property</option>
                    <option value="condo">Condominium</option>
                    <option value="apartment">Apartment</option>
                    <option value="plot">Plot for Sale</option>
                </select>
                
                <select class="form-control" name="location">
                    <option value="">All Locations</option>
                    <option value="dhaka">Dhaka</option>
                    <option value="chittagong">Chittagong</option>
                    <option value="khulna">Khulna</option>
                    <option value="rajshahi">Rajshahi</option>
                </select>
                
                <select class="form-control" name="price-range">
                    <option value="">Price Range</option>
                    <option value="range1">Below ৳10,000,000</option>
                    <option value="range2">৳10,000,000 - ৳20,000,000</option>
                    <option value="range3">৳20,000,000 - ৳30,000,000</option>
                    <option value="range4">Above ৳30,000,000</option>
                </select>
            </div>
            
            <div class="sort-group">
                <select class="form-control" name="sort-by">
                    <option value="newest">Newest First</option>
                    <option value="price-asc">Price: Low to High</option>
                    <option value="price-desc">Price: High to Low</option>
                    <option value="area-asc">Area: Small to Large</option>
                </select>
            </div>
        </div>
        
        <div class="property-grid" id="main-property-listings">
            <!-- Properties will be loaded dynamically -->
        </div>
        
        <div class="pagination" style="display: flex; justify-content: center; margin-top: 40px;">
            <a href="#" class="btn-small" style="margin-right: 10px;">Previous</a>
            <a href="#" class="btn-small" style="background-color: var(--primary-dark); margin-right: 10px;">1</a>
            <a href="#" class="btn-small" style="margin-right: 10px;">2</a>
            <a href="#" class="btn-small" style="margin-right: 10px;">3</a>
            <a href="#" class="btn-small">Next</a>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>PropertyHub</h3>
                <p>Your trusted platform for business real estate in Bangladesh.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="properties.html">Properties</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="register.html">Register</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p>Email: info@propertyhub.bd</p>
                <p>Phone: +880 123 456 7890</p>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2023 PropertyHub. All rights reserved.</p>
        </div>
    </footer>

    <script src="../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load all approved properties
            loadAllProperties();
            
            // Add event listeners for filter controls
            const filterControls = document.querySelectorAll('.filter-group select, .sort-group select');
            filterControls.forEach(control => {
                control.addEventListener('change', function() {
                    filterAndSortProperties();
                });
            });
        });
        
        // Load all approved properties from localStorage
        function loadAllProperties() {
            const propertiesContainer = document.getElementById('main-property-listings');
            if (!propertiesContainer) return;
            
            // Get all properties from localStorage
            const properties = JSON.parse(localStorage.getItem('properties') || '[]');
            
            // Filter to only approved properties
            const approvedProperties = properties.filter(p => p.status === 'approved');
            
            if (approvedProperties.length === 0) {
                propertiesContainer.innerHTML = `
                    <div style="grid-column: span 3; text-align: center; padding: 30px;">
                        <p>No properties available at the moment.</p>
                    </div>
                `;
                return;
            }
            
            // Clear the container
            propertiesContainer.innerHTML = '';
            
            // Add each property to the grid
            approvedProperties.forEach(property => {
                // Determine the price display based on listing type
                let priceDisplay = '';
                if (property.listingType === 'rent') {
                    priceDisplay = `৳${Number(property.rent).toLocaleString()}/month`;
                } else {
                    priceDisplay = `৳${Number(property.price).toLocaleString()}`;
                }
                
                // Create property card
                const propertyCard = document.createElement('div');
                propertyCard.className = 'property-card';
                
                // Determine image to use
                let imageUrl = '../images/property1.jpg'; // Default image
                if (property.images && property.images.length > 0) {
                    imageUrl = property.images[0].content;
                } else {
                    // Choose default image based on property type
                    if (property.type === 'apartment' || property.type === 'condo') {
                        imageUrl = '../images/property2.jpg';
                    } else if (property.type === 'warehouse' || property.type === 'industrial') {
                        imageUrl = '../images/property3.jpg';
                    } else if (property.type === 'plot') {
                        imageUrl = '../images/property4.jpg';
                    }
                }
                
                propertyCard.innerHTML = `
                    <div class="property-image" style="background-image: url('${imageUrl}')"></div>
                    <div class="property-details">
                        <h3>${property.title}</h3>
                        <p class="location">${property.address}, ${property.city}</p>
                        <p class="price">${priceDisplay}</p>
                        <a href="property-details.html?id=${property.id}" class="btn-small">View Details</a>
                    </div>
                `;
                
                propertiesContainer.appendChild(propertyCard);
            });
        }
        
        // Filter and sort properties based on selected criteria
        function filterAndSortProperties() {
            const propertyType = document.querySelector('select[name="property-type"]').value;
            const location = document.querySelector('select[name="location"]').value;
            const priceRange = document.querySelector('select[name="price-range"]').value;
            const sortBy = document.querySelector('select[name="sort-by"]').value;
            
            // Get all properties from localStorage
            const properties = JSON.parse(localStorage.getItem('properties') || '[]');
            
            // Start with approved properties
            let filteredProperties = properties.filter(p => p.status === 'approved');
            
            // Apply property type filter
            if (propertyType) {
                filteredProperties = filteredProperties.filter(p => p.type === propertyType);
            }
            
            // Apply location filter
            if (location) {
                filteredProperties = filteredProperties.filter(p => 
                    p.city.toLowerCase().includes(location.toLowerCase())
                );
            }
            
            // Apply price range filter
            if (priceRange) {
                const ranges = {
                    'range1': { min: 0, max: 10000000 },
                    'range2': { min: 10000000, max: 20000000 },
                    'range3': { min: 20000000, max: 30000000 },
                    'range4': { min: 30000000, max: Infinity }
                };
                
                const range = ranges[priceRange];
                if (range) {
                    filteredProperties = filteredProperties.filter(p => {
                        const price = p.listingType === 'rent' ? 
                            Number(p.rent) : Number(p.price);
                        return price >= range.min && price <= range.max;
                    });
                }
            }
            
            // Apply sorting
            if (sortBy) {
                switch (sortBy) {
                    case 'newest':
                        filteredProperties.sort((a, b) => 
                            new Date(b.createdAt) - new Date(a.createdAt)
                        );
                        break;
                    case 'price-asc':
                        filteredProperties.sort((a, b) => {
                            const priceA = a.listingType === 'rent' ? 
                                Number(a.rent) : Number(a.price);
                            const priceB = b.listingType === 'rent' ? 
                                Number(b.rent) : Number(b.price);
                            return priceA - priceB;
                        });
                        break;
                    case 'price-desc':
                        filteredProperties.sort((a, b) => {
                            const priceA = a.listingType === 'rent' ? 
                                Number(a.rent) : Number(a.price);
                            const priceB = b.listingType === 'rent' ? 
                                Number(b.rent) : Number(b.price);
                            return priceB - priceA;
                        });
                        break;
                    case 'area-asc':
                        filteredProperties.sort((a, b) => 
                            Number(a.area) - Number(b.area)
                        );
                        break;
                }
            }
            
            // Update the display
            const propertiesContainer = document.getElementById('main-property-listings');
            if (!propertiesContainer) return;
            
            // Check if any properties match the filters
            if (filteredProperties.length === 0) {
                propertiesContainer.innerHTML = `
                    <div style="grid-column: span 3; text-align: center; padding: 30px;">
                        <p>No properties match your filter criteria.</p>
                    </div>
                `;
                return;
            }
            
            // Clear the container
            propertiesContainer.innerHTML = '';
            
            // Add each filtered property to the grid
            filteredProperties.forEach(property => {
                // Determine the price display based on listing type
                let priceDisplay = '';
                if (property.listingType === 'rent') {
                    priceDisplay = `৳${Number(property.rent).toLocaleString()}/month`;
                } else {
                    priceDisplay = `৳${Number(property.price).toLocaleString()}`;
                }
                
                // Create property card
                const propertyCard = document.createElement('div');
                propertyCard.className = 'property-card';
                
                // Determine image to use
                let imageUrl = '../images/property1.jpg'; // Default image
                if (property.images && property.images.length > 0) {
                    imageUrl = property.images[0].content;
                } else {
                    // Choose default image based on property type
                    if (property.type === 'apartment' || property.type === 'condo') {
                        imageUrl = '../images/property2.jpg';
                    } else if (property.type === 'warehouse' || property.type === 'industrial') {
                        imageUrl = '../images/property3.jpg';
                    } else if (property.type === 'plot') {
                        imageUrl = '../images/property4.jpg';
                    }
                }
                
                propertyCard.innerHTML = `
                    <div class="property-image" style="background-image: url('${imageUrl}')"></div>
                    <div class="property-details">
                        <h3>${property.title}</h3>
                        <p class="location">${property.address}, ${property.city}</p>
                        <p class="price">${priceDisplay}</p>
                        <a href="property-details.html?id=${property.id}" class="btn-small">View Details</a>
                    </div>
                `;
                
                propertiesContainer.appendChild(propertyCard);
            });
        }
    </script>
</body>
</html> 